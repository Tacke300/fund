<div style="display: flex; gap: 10px; margin-bottom: 10px;">
    <span style="color: var(--text-muted)">Sắp xếp View:</span>
    <button class="btn" style="padding: 2px 10px; font-size: 12px; background: #333;" onclick="setSort('desc')">Cao -> Thấp</button>
    <button class="btn" style="padding: 2px 10px; font-size: 12px; background: #333;" onclick="setSort('asc')">Thấp -> Cao</button>
</div>

<table>
    <thead>
        <tr>
            <th>Coin</th>
            <th>Thời gian</th>
            <th>Lượt xem <i class="fa-solid fa-eye"></i></th>
            <th>Trạng thái</th>
        </tr>
    </thead>
    <tbody id="logTable"></tbody>
</table>

<script>
    let currentSort = 'none'; // 'asc' hoặc 'desc'

    function setSort(type) {
        currentSort = type;
        updateStats(); // Cập nhật lại giao diện ngay lập tức
    }

    function updateStats() {
        fetch('/stats')
            .then(res => res.json())
            .then(data => {
                document.getElementById('totalPosts').innerText = data.totalPosts;
                
                let history = [...data.history];
                if (currentSort === 'desc') {
                    history.sort((a, b) => b.views - a.views);
                } else if (currentSort === 'asc') {
                    history.sort((a, b) => a.views - b.views);
                }

                let html = '';
                history.forEach(log => {
                    html += `<tr>
                        <td><b>$${log.coin}</b></td>
                        <td>${log.time}</td>
                        <td style="color: var(--binance-yellow)">${log.viewDisplay || log.views}</td>
                        <td><span class="badge badge-success">${log.status}</span></td>
                    </tr>`;
                });
                document.getElementById('logTable').innerHTML = html;
            });
    }
    setInterval(updateStats, 3000);
</script>
