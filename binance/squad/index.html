<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Binance Square Analyst Bot</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #0b0e11; --card: #1e2329; --yellow: #fcd535; --text: #eaecef;
            --muted: #848e9c; --green: #0ecb81; --red: #f6465d;
        }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #333; text-align: center; }
        .stat-value { font-size: 32px; font-weight: bold; color: var(--yellow); }
        .card { background: var(--card); border-radius: 12px; padding: 20px; border: 1px solid #333; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn { border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
        .btn-start { background: var(--green); }
        .btn-stop { background: var(--red); }
        .btn-sort { background: #474d57; font-size: 12px; }
        .btn-sort.active { background: var(--yellow); color: black; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: var(--muted); padding: 12px; border-bottom: 1px solid #333; }
        td { padding: 15px 12px; border-bottom: 1px solid #2b3139; }
        .coin-tag { background: rgba(252, 213, 53, 0.1); color: var(--yellow); padding: 4px 8px; border-radius: 4px; }
        .dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .online { background: var(--green); box-shadow: 0 0 10px var(--green); }
        .offline { background: var(--red); }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1 style="color: var(--yellow)"><i class="fa-solid fa-chart-line"></i> BINANCE SQUARE ANALYST</h1>
        <div id="statusInfo"><span class="dot offline"></span> Hệ thống đang dừng</div>
    </div>

    <div class="stats-grid">
        <div class="stat-card"><div style="color:var(--muted)">Tổng bài đăng</div><div class="stat-value" id="totalPosts">0</div></div>
        <div class="stat-card"><div style="color:var(--muted)">Lần đăng cuối</div><div class="stat-value" id="lastRun" style="font-size: 24px;">--:--</div></div>
        <div class="stat-card"><div style="color:var(--muted)">Cổng hệ thống</div><div class="stat-value">9999</div></div>
    </div>

    <div class="card">
        <div class="btn-group">
            <button class="btn btn-start" onclick="fetch('/start')"><i class="fa-solid fa-play"></i> BẮT ĐẦU BOT</button>
            <button class="btn btn-stop" onclick="fetch('/stop')"><i class="fa-solid fa-stop"></i> DỪNG BOT</button>
        </div>

        <div style="margin-bottom: 15px;">
            <span style="font-size: 13px; color: var(--muted);">Sắp xếp lượt xem: </span>
            <button id="sNone" class="btn btn-sort active" onclick="setSort('none')">Mới nhất</button>
            <button id="sDesc" class="btn btn-sort" onclick="setSort('desc')">View Cao -> Thấp</button>
            <button id="sAsc" class="btn btn-sort" onclick="setSort('asc')">View Thấp -> Cao</button>
        </div>

        <table>
            <thead>
                <tr><th>Đồng Coin</th><th>Thời gian</th><th>Lượt xem thực</th><th>Trạng thái</th></tr>
            </thead>
            <tbody id="logTable"></tbody>
        </table>
    </div>
</div>

<script>
    let currentSort = 'none';

    function setSort(type) {
        currentSort = type;
        document.querySelectorAll('.btn-sort').forEach(b => b.classList.remove('active'));
        if(type === 'none') document.getElementById('sNone').classList.add('active');
        if(type === 'desc') document.getElementById('sDesc').classList.add('active');
        if(type === 'asc') document.getElementById('sAsc').classList.add('active');
        refresh();
    }

    async function refresh() {
        const res = await fetch('/stats');
        const data = await res.json();

        document.getElementById('totalPosts').innerText = data.totalPosts;
        document.getElementById('lastRun').innerText = data.lastRun || '--:--';
        
        const statusDiv = document.getElementById('statusInfo');
        statusDiv.innerHTML = data.isRunning ? '<span class="dot online"></span> Đang hoạt động' : '<span class="dot offline"></span> Hệ thống dừng';

        let history = [...data.history];
        if (currentSort === 'desc') history.sort((a, b) => b.views - a.views);
        if (currentSort === 'asc') history.sort((a, b) => a.views - b.views);

        const rows = history.map(h => `
            <tr>
                <td><span class="coin-tag">$${h.coin}</span></td>
                <td>${h.time}</td>
                <td style="color: var(--yellow); font-weight: bold;"><i class="fa-solid fa-eye"></i> ${h.viewDisplay || 0}</td>
                <td><span style="color: var(--green)">Thành công</span></td>
            </tr>
        `).join('');
        document.getElementById('logTable').innerHTML = rows;
    }

    setInterval(refresh, 3000);
    refresh();
</script>
</body>
</html>
