<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Pump-Dump VIP PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap');

        :root {
            --neon-blue: #00d2ff;
            --neon-purple: #9d50bb;
            --glass-bg: rgba(15, 23, 42, 0.8);
        }

        body {
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: #e2e8f0;
            font-family: 'Rajdhani', sans-serif;
            min-height: 100vh;
        }

        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
            border-radius: 20px;
        }

        .neon-text {
            text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
            font-family: 'Orbitron', sans-serif;
        }

        .status-running {
            background: #10b981;
            box-shadow: 0 0 15px #10b981;
        }

        .status-stopped {
            background: #ef4444;
            box-shadow: 0 0 15px #ef4444;
        }

        .cyber-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            transition: all 0.3s;
        }

        .cyber-input:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 210, 255, 0.5);
            outline: none;
        }

        .btn-vipro {
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple));
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-vipro:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(0, 210, 255, 0.6);
        }

        /* Scrollbar xịn */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--neon-blue); border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="flex justify-between items-center mb-8 glass-card p-6 border-b-2 border-cyan-500">
            <div>
                <h1 class="text-3xl font-bold neon-text tracking-widest">PUMP-DUMP TERMINAL</h1>
                <p class="text-xs text-cyan-400 opacity-70">SYSTEM VERSION 4.0 PRO MAX</p>
            </div>
            <div class="flex items-center gap-4">
                <div id="statusDot" class="w-3 h-3 rounded-full status-stopped"></div>
                <button id="toggleBtn" onclick="toggleBot()" class="btn-vipro px-6 py-2 rounded-full font-bold uppercase text-sm">Start System</button>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-1 space-y-6">
                <div class="glass-card p-6">
                    <h3 class="text-cyan-400 font-bold mb-4 uppercase italic">Live Balance</h3>
                    <div class="text-4xl font-bold mb-2" id="currentBalance">$0.00</div>
                    <div class="flex justify-between text-sm opacity-70">
                        <span>Initial: <b id="initialBalance">$0</b></span>
                        <span>ATH: <b id="highestBalance">$0</b></span>
                    </div>
                    <div class="mt-4 h-2 bg-gray-700 rounded-full overflow-hidden">
                        <div id="pnlBar" class="h-full bg-cyan-500 w-0 transition-all duration-500"></div>
                    </div>
                </div>

                <div class="glass-card p-6">
                    <h3 class="text-purple-400 font-bold mb-4 uppercase italic">Configuration</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs mb-1">MAX POSITIONS</label>
                            <input type="number" id="maxPositions" class="cyber-input w-full p-2 rounded">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-xs mb-1">INV VALUE</label>
                                <input type="number" id="invValue" class="cyber-input w-full p-2 rounded">
                            </div>
                            <div>
                                <label class="block text-xs mb-1">TYPE</label>
                                <select id="invType" class="cyber-input w-full p-2 rounded">
                                    <option value="fixed">Fixed (USD)</option>
                                    <option value="percent">% Balance</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="updateSettings()" class="w-full bg-white/10 hover:bg-white/20 py-2 rounded font-bold transition">APPLY SETTINGS</button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-6">
                <div class="glass-card p-6 h-[500px] flex flex-col">
                    <h3 class="text-cyan-400 font-bold mb-4 uppercase italic flex items-center gap-2">
                        <i class="fas fa-list-ul"></i> Recent Orders
                    </h3>
                    <div class="overflow-y-auto flex-grow pr-2">
                        <table class="w-full text-left">
                            <thead class="sticky top-0 bg-[#0f172a] text-xs opacity-50">
                                <tr>
                                    <th class="pb-2">COIN</th>
                                    <th class="pb-2">SIDE</th>
                                    <th class="pb-2">CAPITAL</th>
                                    <th class="pb-2">TP/SL</th>
                                    <th class="pb-2">TIME</th>
                                </tr>
                            </thead>
                            <tbody id="historyBody" class="text-sm">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        async function updateUI() {
            try {
                const res = await fetch('/api/status');
                const data = await res.json();
                
                // Cập nhật số dư
                document.getElementById('currentBalance').innerText = '$' + data.status.currentBalance.toFixed(2);
                document.getElementById('initialBalance').innerText = '$' + data.status.initialBalance.toFixed(2);
                document.getElementById('highestBalance').innerText = '$' + data.status.highestBalance.toFixed(2);
                
                // Cập nhật trạng thái nút
                const dot = document.getElementById('statusDot');
                const btn = document.getElementById('toggleBtn');
                if(data.botSettings.isRunning) {
                    dot.className = "w-3 h-3 rounded-full status-running";
                    btn.innerText = "STOP SYSTEM";
                    btn.classList.replace('btn-vipro', 'bg-red-500');
                } else {
                    dot.className = "w-3 h-3 rounded-full status-stopped";
                    btn.innerText = "START SYSTEM";
                    btn.className = "btn-vipro px-6 py-2 rounded-full font-bold uppercase text-sm";
                }

                // Cập nhật bảng history
                const tbody = document.getElementById('historyBody');
                tbody.innerHTML = data.history.reverse().map(log => `
                    <tr class="border-b border-white/5 hover:bg-white/5 transition">
                        <td class="py-3 font-bold text-cyan-300">${log.symbol}</td>
                        <td class="py-3">
                            <span class="px-2 py-0.5 rounded text-[10px] ${log.side === 'LONG' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                                ${log.side}
                            </span>
                        </td>
                        <td class="py-3 text-gray-400">$${log.capital}</td>
                        <td class="py-3 text-[11px]">
                            <span class="text-green-400">T: ${log.tp}</span><br>
                            <span class="text-red-400">S: ${log.sl}</span>
                        </td>
                        <td class="py-3 text-[10px] opacity-50">${log.time.split(',')[1]}</td>
                    </tr>
                `).join('');

                // Fill inputs if empty
                if(!document.activeElement.classList.contains('cyber-input')) {
                    document.getElementById('maxPositions').value = data.botSettings.maxPositions;
                    document.getElementById('invValue').value = data.botSettings.invValue;
                    document.getElementById('invType').value = data.botSettings.invType;
                }

            } catch (e) { console.error("UI Update Error", e); }
        }

        async function updateSettings() {
            const body = {
                maxPositions: parseInt(document.getElementById('maxPositions').value),
                invValue: parseFloat(document.getElementById('invValue').value),
                invType: document.getElementById('invType').value
            };
            await fetch('/api/settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(body)
            });
            alert("✅ Đã cập nhật cấu hình VIP!");
        }

        async function toggleBot() {
            const res = await fetch('/api/status');
            const data = await res.json();
            await fetch('/api/settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ isRunning: !data.botSettings.isRunning })
            });
        }

        setInterval(updateUI, 2000);
        updateUI();
    </script>
</body>
</html>
